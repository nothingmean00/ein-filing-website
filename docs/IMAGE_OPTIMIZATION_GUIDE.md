# Image Optimization Guide

## Overview
This document outlines the comprehensive image optimization strategy implemented for the EIN National Filing website to improve Core Web Vitals, reduce bandwidth usage, and enhance user experience.

## Optimizations Implemented

### 1. Next.js Image Configuration
**File:** `next.config.mjs`

```javascript
images: {
  domains: ['placeholder.com'],
  formats: ['image/webp', 'image/avif'],
  deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  minimumCacheTTL: 60 * 60 * 24 * 365, // 1 year
  dangerouslyAllowSVG: true,
  contentSecurityPolicy: "default-src 'self'; script-src 'none'; sandbox;",
}
```

**Benefits:**
- Automatic WebP/AVIF format conversion
- Responsive image sizing
- Long-term caching
- SVG support with security

### 2. Automated Image Compression
**Script:** `scripts/optimize-images.mjs`

**Features:**
- PNG optimization with pngquant (60-80% quality)
- JPEG optimization with mozjpeg (85% quality, progressive)
- WebP conversion (80% quality)
- Automatic size comparison reporting

**Results:**
- **81.4% file size reduction**
- From 11.69MB to 2.18MB total
- Saves ~9.5MB in bandwidth per user

**Usage:**
```bash
npm run optimize-images
```

### 3. Enhanced Image Component
**Component:** `components/ui/optimized-image.tsx`

**Features:**
- Automatic WebP detection and serving
- Fallback to optimized formats
- Error handling with graceful degradation
- Progressive enhancement

**Usage:**
```tsx
import { OptimizedImage } from '@/components/ui/optimized-image'

<OptimizedImage
  src="/my-image.png"
  alt="Description"
  fill
  sizes="(max-width: 768px) 100vw, 50vw"
  priority={false}
  quality={85}
  placeholder="blur"
/>
```

### 4. Blog Image Optimizations
**File:** `app/blog/page.tsx`

**Improvements:**
- Blur placeholder for loading states
- Hover scale transitions
- Optimal quality settings (85%)
- Proper responsive sizing
- Lazy loading (priority=false)

### 5. Performance Headers & Preloading
**File:** `app/layout.tsx`

**Added:**
- Preconnect to Google Fonts
- DNS prefetch for analytics
- Resource preloading for critical images
- WebP format preferences

## Performance Metrics Impact

### Before Optimization:
- **Total Image Size:** 11.69MB
- **Loading Time:** ~8-12 seconds on 3G
- **Lighthouse Performance:** ~60-70

### After Optimization:
- **Total Image Size:** 2.18MB
- **Loading Time:** ~2-3 seconds on 3G
- **Lighthouse Performance:** ~85-95 (estimated)

## File Structure

```
public/
├── optimized/           # Compressed PNG/JPEG files
│   ├── *.png           # Optimized PNG files
│   ├── *.jpg           # Optimized JPEG files
│   └── webp/           # WebP versions
│       └── *.webp      # WebP converted files
├── *.png               # Original files (kept for backup)
└── *.jpg               # Original files (kept for backup)
```

## Best Practices

### 1. Image Sizing Guidelines
- **Hero Images:** Max 1920px width
- **Blog Thumbnails:** 400x300px optimal
- **Logos:** Vector (SVG) preferred, PNG fallback
- **Icons:** Use SVG or icon fonts

### 2. Format Selection Priority
1. **AVIF** (Next.js auto-converts)
2. **WebP** (Generated by our script)
3. **Optimized PNG/JPEG** (Compressed versions)
4. **Original** (Fallback only)

### 3. Quality Settings
- **Photos:** 80-85% JPEG quality
- **Graphics/Screenshots:** PNG with pngquant
- **Logos:** SVG or high-quality PNG
- **Thumbnails:** 75-80% quality acceptable

### 4. Loading Strategy
- **Above-fold images:** `priority={true}`
- **Blog images:** `priority={false}` (lazy load)
- **Decorative images:** Always lazy load
- **Critical images:** Preload in layout

## Monitoring & Maintenance

### 1. Regular Optimization
Run image optimization script monthly or when adding new images:
```bash
npm run optimize-images
```

### 2. Performance Monitoring
- Monitor Core Web Vitals in Google Search Console
- Use Lighthouse CI for automated testing
- Track image loading metrics in Google Analytics

### 3. Image Audit Checklist
- [ ] All images under 500KB
- [ ] WebP versions available for large images
- [ ] Proper alt text for accessibility
- [ ] Responsive sizing configured
- [ ] Lazy loading enabled (except critical images)

## Tools Used

### Dependencies
- **imagemin:** Core optimization engine
- **imagemin-mozjpeg:** JPEG compression
- **imagemin-pngquant:** PNG compression
- **imagemin-webp:** WebP conversion
- **sharp:** Next.js image processing (built-in)

### External Tools (Optional)
- **TinyPNG API:** For additional compression
- **Squoosh:** Manual image optimization
- **ImageOptim:** macOS image optimization

## Future Improvements

### 1. Advanced Optimizations
- [ ] Implement AVIF format support
- [ ] Add image CDN (Cloudinary/ImageKit)
- [ ] Responsive image art direction
- [ ] Critical image inlining

### 2. Automated Workflows
- [ ] Pre-commit hooks for image optimization
- [ ] GitHub Actions for automated compression
- [ ] Automatic WebP generation on upload

### 3. Performance Enhancements
- [ ] Service worker image caching
- [ ] Progressive image loading
- [ ] Intersection Observer for advanced lazy loading

## Troubleshooting

### Common Issues

**1. WebP not loading:**
- Check browser support
- Verify WebP files exist in `/optimized/webp/`
- Ensure proper fallback in OptimizedImage component

**2. Images appear blurry:**
- Increase quality setting in optimization script
- Check if correct responsive sizes are set
- Verify image dimensions match display size

**3. Slow loading despite optimization:**
- Check if images are properly lazy loaded
- Verify preloading isn't overused
- Ensure CDN/caching is configured

### Debug Commands
```bash
# Check optimized file sizes
ls -la public/optimized/

# Verify WebP generation
ls -la public/optimized/webp/

# Test image optimization
npm run optimize-images
```

---

*Last updated: December 2024*
*Author: EIN National Filing Development Team* 